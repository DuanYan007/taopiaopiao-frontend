<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ç™»å½• - æ·˜ç¥¨ç¥¨ç®¡ç†åå°</title>
    <link rel="stylesheet" href="/assets/css/common.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
</head>
<body style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;">
        <div class="admin-form" style="width: 100%; max-width: 440px;">
            <!-- Logo -->
            <div class="text-center" style="margin-bottom: 40px;">
                <div style="font-size: 56px; margin-bottom: 16px;">ğŸ«</div>
                <h1 style="font-size: 28px; font-weight: 700; color: #2c3e50; margin-bottom: 8px;">æ·˜ç¥¨ç¥¨ç®¡ç†åå°</h1>
                <p class="text-muted">ç®¡ç†å‘˜ç™»å½•</p>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">ç®¡ç†å‘˜è´¦å·</label>
                    <input type="text" class="form-input" name="username" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·" required>
                </div>

                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-input" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="remember" style="margin-right: 8px;">
                        <span class="text-small">è®°ä½ç™»å½•çŠ¶æ€</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px; padding: 14px; font-size: 16px;">ç™»å½•</button>

                <div id="errorMessage" class="text-center" style="margin-top: 16px; color: #d32f2f; display: none;"></div>
            </form>

            <div class="text-center text-small text-muted" style="margin-top: 32px;">
                å¿˜è®°å¯†ç ï¼Ÿ<a href="#" style="color: #1976d2;">è”ç³»ç³»ç»Ÿç®¡ç†å‘˜</a>
            </div>

            <!-- å®‰å…¨æç¤º -->
            <div class="text-center text-small text-muted" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #eee;">
                <p>ä¸ºäº†æ‚¨çš„è´¦æˆ·å®‰å…¨ï¼Œè¯·æ³¨æ„ï¼š</p>
                <ul style="list-style: none; padding: 0; margin-top: 12px; line-height: 1.8;">
                    <li>â€¢ è¯·ä½¿ç”¨å®˜æ–¹åˆ†é…çš„è´¦å·å¯†ç ç™»å½•</li>
                    <li>â€¢ ä¸è¦åœ¨å…¬å…±è®¾å¤‡ä¸Šä¿å­˜ç™»å½•çŠ¶æ€</li>
                    <li>â€¢ å®šæœŸæ›´æ¢å¯†ç ï¼Œç¡®ä¿è´¦æˆ·å®‰å…¨</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="/assets/js/auth.js"></script>
    <script>
        // ç™»å½•è¡¨å•å¤„ç†
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            hideError();

            const formData = new FormData(e.target);
            const username = formData.get('username').trim();
            const password = formData.get('password');
            const remember = formData.get('remember') === 'on';

            // ç®€å•éªŒè¯
            if (!username || !password) {
                showError('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }

            // ç¦ç”¨æäº¤æŒ‰é’®
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'ç™»å½•ä¸­...';

            try {
                // è°ƒç”¨ç™»å½•æ¥å£
                const response = await fetch('/api/admin/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();

                if (result.code === 200) {
                    // ç™»å½•æˆåŠŸ
                    const { token, userInfo } = result.data;
                    saveToken(token, userInfo, remember);
                    window.location.href = 'admin-index.html';
                } else {
                    // ç™»å½•å¤±è´¥
                    showError(result.msg || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                console.error('ç™»å½•é”™è¯¯:', error);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            }
        });

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.display = 'none';
        }
    </script>
</body>
</html>
